"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}requirejs.config({baseUrl:"src/javascript",paths:{app:"../dist"}}),requirejs(["main"],function(e){e.init()}),define("main",["components/weather","datasource/weather","datasource/map"],function(e,t,n){return{init:function(){console.log("Initiated Clima");var r=document.querySelector("#js-clima"),o=new t({units:"f"}),i=new n;r&&(this.clima=new e(r,o,i))}}});var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();define("components/weather",[],function(){return function(){function e(t,n,r){_classCallCheck(this,e),this.clima=t,this.weatherSource=n,this.mapSource=r,this.loadingSecton=document.querySelector("#js-loading"),this.currentClimaBlockSection=null,this.loadingElement=this.weatherSource.createLoadingElement(),this.requestInProgress=!1,this.latitude=null,this.longitude=null,this.city=null,this.temperature=null,this.addEventListeners(),this.loadClima()}return _createClass(e,[{key:"addEventListeners",value:function(){var e=this;document.querySelector("#js-refresh").addEventListener("click",function(){return e.refreshClima()})}},{key:"loadClima",value:function(){var e=this;this.requestInProgress=!0,this.showLoading(),this.getLocation().then(function(t){var n=t.coords;return e.latitude=n.latitude,e.longitude=n.longitude,e.mapSource.getCity(e.latitude,e.longitude)}).then(function(t){return e.city=t,e.weatherSource.getForecast(e.latitude,e.longitude)}).then(function(t){return e.populateClima(t)})}},{key:"populateClima",value:function(e){var t=e.currently.temperature,n=this.determineClimaBlock(t,this.weatherSource.unitSymbol.toUpperCase());this.currentClimaBlockSection=this.clima.querySelector(n);var r=this.weatherSource.render({city:this.city,temp:t});this.currentClimaBlockSection.appendChild(r),this.currentClimaBlockSection.classList.add("clima__temperature--active"),this.removeLoading(),this.requestInProgress=!1}},{key:"showLoading",value:function(){this.loadingSecton.appendChild(this.loadingElement)}},{key:"removeLoading",value:function(){this.loadingSecton.removeChild(this.loadingElement)}},{key:"refreshClima",value:function(){this.clearClima(),this.loadClima()}},{key:"clearClima",value:function(){this.currentClimaBlockSection.removeChild(this.currentClimaBlockSection.firstChild),this.currentClimaBlockSection.classList.remove("clima__temperature--active")}},{key:"getLocation",value:function(){return new Promise(function(e,t){navigator.geolocation.getCurrentPosition(function(t){return e(t)},function(e){return t(e)})})}},{key:"locationFailure",value:function(e){console.log("ERROR("+err.code+"): "+err.message),this.requestInProgress=!1}},{key:"determineClimaBlock",value:function(e,t){var n="js-clima--normal";return"C"===t&&(e=this.convertToFahrenheit(e)),e>105?n="js-clima--hot7":e>100&&e<=105?n="js-clima--hot6":e>95&&e<=100?n="js-clima--hot5":e>90&&e<=95?n="js-clima--hot4":e>85&&e<=90?n="js-clima--hot3":e>80&&e<=85?n="js-clima--hot2":e>75&&e<=80?n="js-clima--hot1":e>=70&&e<=75?n="js-clima--normal":e>=65&&e<70?n="js-clima--cold1":e>=60&&e<65?n="js-clima--cold2":e>=55&&e<60?n="js-clima--cold3":e>=50&&e<55?n="js-clima--cold4":e>=45&&e<50?n="js-clima--cold5":e>=40&&e<45?n="js-clima--cold6":e<40&&(n="js-clima--cold7"),"#"+n}},{key:"convertToFahrenheit",value:function(e){return 1.8*e+32}}]),e}()});var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();define("datasource/datasource",[],function(){return function(){function e(t){_classCallCheck(this,e)}return _createClass(e,[{key:"fetch",value:function(e){return new Promise(function(t,n){var r=e.params;r&&"object"===(void 0===r?"undefined":_typeof(r))&&(r=Object.keys(r).map(function(e){return encodeURIComponent(e)+"="+encodeURIComponent(r[e])}).join("&"));var o=r?e.url+"?"+r:e.url,i=new XMLHttpRequest;i.open(e.method||"GET",o),i.onload=function(){i.status>=200&&i.status<300?t(i.response):n(i.statusText)},i.onerror=function(){n(i.statusText)},i.send()})}}]),e}()});var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();define("datasource/map",["datasource/datasource"],function(e){return function(e){function t(e){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this))}return _inherits(t,e),_createClass(t,[{key:"getCity",value:function(e,t){var n={method:"GET",url:"https://maps.googleapis.com/maps/api/geocode/json?latlng="+e+","+t};return this.fetch(n).then(function(e){var t=JSON.parse(e),n=void 0,r=void 0,o=t.results[0].address_components,i=o.length;for(n=0;n<i;n+=1){var a=o[n];if("locality"===a.types[0]){r=a.short_name;break}}return r})}}]),t}(e)});var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();define("datasource/weather",["datasource/datasource"],function(e){return function(e){function t(e){_classCallCheck(this,t);var n=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n.templates=document.querySelector("#js-templates"),n.temperatureTemplate=n.templates.querySelector("#js-templates .clima__item"),n.loadingTemplate=n.templates.querySelector("#js-templates .loading__container"),n.templates.removeChild(n.loadingTemplate),n.unitSymbol=e.units||"F",n.units="F"===n.unitSymbol.toUpperCase()?"imperial":"metric",n}return _inherits(t,e),_createClass(t,[{key:"getWeather",value:function(e,t){var n={method:"GET",url:"https://crossorigin.me/http://api.openweathermap.org/data/2.5/weather?lat="+e+"&lon="+t+"&units="+this.units+"&APPID=f1db55c38112d4be78d14107861cb2c8"};return this.fetch(n).then(function(e){return JSON.parse(e)})}},{key:"getForecast",value:function(e,t){var n=this,r={method:"GET",url:"https://api.darksky.net/forecast/d1d02e99b64fd7ba063978ac19af2f04/"+e+","+t};return new Promise(function(e,t){window.callbackJSON=function(t){delete window.callbackJSON,document.body.removeChild(n.dummyScript),n.dummyScript=null,e(t)},n.dummyScript=document.createElement("script"),n.dummyScript.src=r.url+"?callback=callbackJSON",n.dummyScript.onerror=t,document.body.appendChild(n.dummyScript)})}},{key:"createLoadingElement",value:function(){return this.loadingTemplate.cloneNode(!0)}},{key:"render",value:function(e,t){return t=t||this.temperatureTemplate.cloneNode(!0),t.querySelector(".clima__city").textContent=e.city,t.querySelector(".clima__forecast").textContent=""+Math.round(e.temp),t}}]),t}(e)});
//# sourceMappingURL=main.min.js.map
